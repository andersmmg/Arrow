<!DOCTYPE html> <html> <head> <title>{{project_title}}</title> <meta charset="utf-8"> <meta name="color-scheme"content="dark light"> <meta name="keywords"content="Arrow,adventure,{{project_title}}"> <meta name="description"content="{{project_title}}: An adventure made with Arrow"> <script type="text/javascript"> const PROJECT = {{project_json}}; const t=["en"],e={continue:{en:"Continue"},false:{en:"False"},true:{en:"True"},defaultCheckboxClickableLabelText:{en:"Positive!"},evaluate:{en:"Evaluate"},generate:{en:"Generate"},end_of_play:{en:"The End !"}};function i(i,s){if(false==t.includes(s)){s=v}if(e.hasOwnProperty(i)){if(e[i].hasOwnProperty(s)){return e[i][s]}else{throw new Error(`Incomplete Translation Table: value for the selected locale doesn't exist! _TRANSLATION_TABLE[${i}][${s}]`)}}else{throw new Error(`I18n translation table doesn't include the string id: ${i} `)}}const s={'\\[br\\]':'<br>','\\[b\\](.+?)\\[/b\\]':'<strong>$1</strong>','\\[i\\](.+?)\\[/i\\]':'<em>$1</em>','\\[u\\](.+?)\\[/u\\]':'<u>$1</u>','\\[h1\\](.+?)\\[/h1\\]':'<h1>$1</h1>','\\[h2\\](.+?)\\[/h2\\]':'<h2>$1</h2>','\\[h3\\](.+?)\\[/h3\\]':'<h3>$1</h3>','\\[h4\\](.+?)\\[/h4\\]':'<h4>$1</h4>','\\[h5\\](.+?)\\[/h5\\]':'<h5>$1</h5>','\\[h6\\](.+?)\\[/h6\\]':'<h6>$1</h6>','\\[p\\](.+?)\\[/p\\]':'<p>$1</p>','\\[color=(.+?)\\](.+?)\\[/color\\]':'<span style="color:$1">$2</span>','\\[size=([0-9]+)\\](.+?)\\[/size\\]':'<span style="font-size:$1px">$2</span>','\\[img\\](.+?)\\[/img\\]':'<img src="$1">','\\[img=(.+?)\\]':'<img src="$1">','\\[email\\](.+?)\\[/email\\]':'<a href="mailto:$1">$1</a>','\\[email=(.+?)\\](.+?)\\[/email\\]':'<a href="mailto:$1">$2</a>','\\[url\\](.+?)\\[/url\\]':'<a href="$1">$1</a>','\\[url=(.+?)\\|onclick\\](.+?)\\[/url\\]':'<a onclick="$1">$2</a>','\\[url=(.+?)\\starget=(.+?)\\](.+?)\\[/url\\]':'<a href="$1" target="$2">$3</a>','\\[url=(.+?)\\](.+?)\\[/url\\]':'<a href="$1">$2</a>','\\[a=(.+?)\\](.+?)\\[/a\\]':'<a href="$1" name="$1">$2</a>','\\[list\\](.+?)\\[/list\\]':'<ul>$1</ul>','\\[\\*\\](.+?)\\[/\\*\\]':'<li>$1</li>','\\[attr=(.+?)\\svalue=(.+?)\\](.+?)\\[/attr\\]':'<span $1="$2">$3</span>','\\[attr=(.+?)\\](.+?)\\[/attr\\]':'<span $1>$2</span>','\\[style=(.+?)\\](.+?)\\[/style\\]':'<span style="$1">$2</span>'};class BBCodeParser{constructor(t){this.codes=[];this.setCodes(t)}parse(t){return this.codes.reduce((t,e)=>t.replace(e.regexp,e.replacement),t)}add(t,e){this.codes.push({regexp:new RegExp(t,'igm'),replacement:e});return this}setCodes(t){this.codes=Object.keys(t).map(function(e){const i=t[e];return{regexp:new RegExp(e,'igm'),replacement:i}},this);return this}}const a=new BBCodeParser(s);function r(t,e,i){if(false==Number.isInteger(e)&&true!==i){e=-1}var s=parseInt(t);s=Number.isInteger(s)?s:e;return s}function n(t){var e=null;if('boolean'!=typeof t){if('string'==typeof t){t=t.toLowerCase();if("true"===t){e=true}else if("false"===t){e=false}}}else{e=t}if(null===e){e=!!t}return e}function o(t,e){for(const i of e){if(false==t.hasOwnProperty(i)){return false}}return true}function l(t,e){if('object'==typeof t&&'number'==typeof e&&e>=0){var i=[];if(t.hasOwnProperty("io")&&Array.isArray(t.io)){for(const s of t.io){if(s.length>=4&&s[0]==e){i[s[1]]={"id":s[2],"slot":s[3]}}}}return i}else{throw new Error("Unable to remap connections for slots: Called with wrong arguments.")}}function h(t,e,i){var s=document.createElement(i||'div');s.className='node';s.setAttribute('data-type',e.type);s.setAttribute('data-name',e.name);s.setAttribute('data-uid',t.toString());return s}function p(t,e,i){var s=document.createElement(t);if(e){if('string'==typeof e){s.innerHTML=e}else if(e instanceof Element){s.appendChild(e)}}if('object'==typeof i){for(const t in i){if(i.hasOwnProperty(t)){s.setAttribute(t,i[t])}}}return s}function d(t,e,i){if('string'==typeof t&&'object'==typeof e){for(const s in e){if(e.hasOwnProperty(s)){const a='{'+s+'}',r=new RegExp(a,true===i?'gi':'g'),n=e[s];t=t.replace(r,n)}}return t}else{throw new Error("Unable to format text: Called with wrong arguments.")}}function u(t,e){if('string'==typeof t){return a.parse(t)}else if(false===e){throw new Error("Unable to parse BBCode: Called with wrong arguments.")}else{return""}}function c(t,e){if('string'==typeof t&&'string'==typeof e){return 0==t.indexOf(e)}else{throw new Error("Called with Wrong Arguments: Expected two strings.")}}function f(t,e){if('string'==typeof t&&'string'==typeof e){var i=t.lastIndexOf(e);return i>=0&&i===t.length-e.length}else{throw new Error("Called with Wrong Arguments: Expected two strings.")}}function _(t){if('string'==typeof t){for(var e=t.replace(/_/gi," "),i="",s=0;s<e.length;s++){var a=e.charAt(s),r=a.toUpperCase();i+=" "!=a&&a==r?` ${a}`:a}i=i.split(" ");for(var n=0;n<i.length;n++){var o=i[n].toLowerCase();i[n]=o.charAt(0).toUpperCase()+o.substring(1)}i=i.join(" ");return i}else{throw new Error("Called with Wrong Arguments: Expected string.")}}const m=function(t,e,i,s,a,r){if(arguments.length<2){e=t;t=0}t=Number.isFinite(t)?Math.ceil(t):0;e=Number.isFinite(e)?Math.floor(e):0;var n=Math.max(t,e),o=Math.min(t,e);let l=null;do{l=Math.floor(Math.random()*(n-o+1))+o;if(a!=r){let t=l%2==0;if(t&&false==a){l=null}if(false==t&&false==r){l=null}}}while(null==l);if(true===s){l*=-1}if(Number.isInteger(i)&&i>=2&&i<=36){return l.toString(i)}else{return l}};class Condition{constructor(t,e,s,a){const r=this,n=0,o=1,d="Condition unset or invalid!";this.get_element=function(){return this.html};this.remove_element=function(){this.html.remove()};this.play_forward_from=function(t){t=parseInt(t);if(false==Number.isFinite(t)||t<0||t>1){t=n}if(this.slots_map.hasOwnProperty(t)){var e=this.slots_map[t];K(e.id,e.slot)}else{X(Q.END_EDGE,r)}this.set_view_played(t)};this.skip_play=function(){this.html.setAttribute('data-skipped',true);if(this.slots_map.hasOwnProperty(n)){this.play_forward_from(n)}else{this.play_forward_from(o)}};this.set_view_played=function(){this.html.setAttribute('data-played',true)};this.set_view_unplayed=function(){this.html.setAttribute('data-played',false)};this.step_back=function(){this.set_view_unplayed()};this.evaluation_and_play=function(){var t=null;if(this.condition_statement){t=this.condition_statement.evaluate()}if('boolean'!=typeof t){t=false;if(b){console.warn(`Evaluation of Condition (${this.node_resource.name}) Failed, therefore considered as 'False'.`)}}this.play_forward_from(true==t?o:n)};this.proceed=function(){if(this.node_map.hasOwnProperty("skip")&&true==this.node_map.skip){this.skip_play()}else{this.evaluation_and_play()}};if(t>=0){if('object'==typeof e&&'object'==typeof s){this.node_id=t;this.node_resource=e;this.node_map=s;this.slots_map=l(s||{},t);this.condition_statement=null;if(this.node_resource.hasOwnProperty("data")){try{this.condition_statement=new ConditionStatement(this.node_resource.data,k)}catch(t){if(b){console.warn('Unable to Parse Condition. Error:'+t)}}}this.html=h(t,e);if(this.condition_statement){var u=this.condition_statement.parse()||d;this.parsed_statement=p("code",u,{"class":"statement"});this.html.appendChild(this.parsed_statement)}this.false_button=p("button",i("false"),{"value":"false"});this.false_button.addEventListener(y,this.play_forward_from.bind(r,n));this.html.appendChild(this.false_button);this.true_button=p("button",i("true"),{"value":"true"});this.true_button.addEventListener(y,this.play_forward_from.bind(r,o));this.html.appendChild(this.true_button)}return this}throw new Error("Unable to construct `Condition`")}}class ConditionStatement{constructor(t,e){const i=this;this.data=null;this.variable=null;const s={0:"value",1:"variable"},a={"value":0,"variable":1},l={"num":{"eq":{"text":"is Equal","sign":"=="},"nq":{"text":"is Not Equal","sign":"!="},"gt":{"text":"is Greater","sign":">"},"gte":{"text":"is Greater or Equal","sign":">="},"ls":{"text":"is Lesser","sign":"<"},"lse":{"text":"is Lesser or Equa)","sign":"<="}},"str":{"rgx":{"text":"Matches RegEx Pattern","sign":"~="},"ct":{"text":"Contains Substring","sign":"%~"},"cts":{"text":"Contains Substring (Case-Sensitive)","sign":"%="},"bgn":{"text":"Begins with","sign":"^="},"end":{"text":"Ends with","sign":"=^"},"eql":{"text":"Has Equal Length","sign":"#="},"lng":{"text":"Is Longer","sign":"#>"},"shr":{"text":"Is Shorter","sign":"#<"}},"bool":{"eq":{"text":"Conforms","sign":"=="},"nq":{"text":"Doesn't Conform","sign":"!="}}},h=["variable","operator","with"],p="{ident} {operator_sign} {parameter}",u="Self (Intial Value)",_="`%s`";this.parse=function(){var t=null;if(this.variable&&this.data){this.statement={"ident":null,"operator_sign":null,"parameter":null};this.statement.ident=this.variable.name;if(l[this.variable.type].hasOwnProperty(this.data.operator)){this.statement.operator_sign=l[this.variable.type][this.data.operator].sign}switch(this.data.with[0]){case a.value:if("str"==this.variable.type){this.statement.parameter=_.replace("%s",this.data.with[1])}else{this.statement.parameter=this.data.with[1]}break;case a.variable:if(this.data.with[1]==this.data.variable){this.statement.parameter=u}else if(k.hasOwnProperty(this.data.with[1])){var e=k[this.data.with[1]];this.statement.parameter=e.name}break}for(const t in this.statement){if(this.statement.hasOwnProperty(t)){if(null===this.statement[t]){this.statement=null;break}}}t=this.statement?d(p,this.statement):null}return t};this.smart_length_parse=function(t){if('number'==typeof t){return r(t,0)}else if('string'==typeof t){var e=parseInt(t);if(e.toString()==t){return e}else{return t.length}}else{return 0}};this.evalutors={"str":function(t,e,s){var a=null;switch(e){case"rgx":try{var r=new RegExp(s);a=t.search(r)>=0}catch(t){if(b){console.warn(`Evaluation Failed! Bad RegEx Match Operation: `+t);console.warn(arguments)}}break;case"ct":var n=t.toLowerCase(),o=s.toLowerCase();a=n.indexOf(o)>=0;break;case"cts":a=t.indexOf(s)>=0;break;case"eql":a=t.length==i.smart_length_parse(s);break;case"lng":a=t.length>i.smart_length_parse(s);break;case"shr":a=t.length<i.smart_length_parse(s);break;case"bgn":a=c(t,s);break;case"end":a=f(t,s);break}return a},"num":function(t,e,i){var s=null;switch(e){case"eq":s=t==i;break;case"nq":s=t!=i;break;case"gt":s=t>i;break;case"gte":s=t>=i;break;case"ls":s=t<i;break;case"lse":s=t<=i;break}return s},"bool":function(t,e,i){var s=null;switch(e){case"eq":s=t==i;break;case"nq":s=t!=i;break}return s}};this.evaluate=function(){var t=null;if(this.variable){var e=this.variable.type,i=this.variable.value,s;switch(this.data.with[0]){case a.value:s=this.data.with[1];break;case a.variable:var o=this.data.with[1];if(k.hasOwnProperty(o)){if(o==this.data.variable){s=k[o].init}else{s=k[o].value}}break}if(null!==s){if("str"==e&&'string'!=typeof s){s=s.toString()}else if("num"==e&&'number'!=typeof s){s=r(s,0)}else if("bool"==e&&'boolean'!=typeof s){s=n(s)}if(l[e].hasOwnProperty(this.data.operator)){t=this.evalutors[e](i,this.data.operator,s)}}}return t};if(o(t,h)&&Array.isArray(t.with)&&2==t.with.length){this.data=t;var m=r(t.variable);if(k.hasOwnProperty(m)){this.variable=k[t.variable]}}else{throw new Error("Invalid Condition! Some of required data is missing: "+h.join(", "))}}}class Content{constructor(t,e,s,a){const n=this,o=-1,c=0,f="h2",_="pre";this.get_element=function(){return this.html};this.remove_element=function(){this.html.remove()};this.play_forward_from=function(t){t=r(t);if(false==Number.isFinite(t)||t<0){t=o}if(this.slots_map.hasOwnProperty(t)){var e=this.slots_map[t];K(e.id,e.slot)}else{X(Q.END_EDGE,n)}this.set_view_played(t)};this.skip_play=function(){this.html.setAttribute('data-skipped',true);this.play_forward_from(o>=0?o:c)};this.set_view_played=function(){this.html.setAttribute('data-played',true)};this.set_view_unplayed=function(){this.html.setAttribute('data-played',false)};this.step_back=function(){this.set_view_unplayed()};this.proceed=function(){if(this.node_map.hasOwnProperty("skip")&&true==this.node_map.skip){this.skip_play()}else if(o>=0){this.play_forward_from(o)}if(this.node_resource.data.hasOwnProperty('clear')&&'boolean'==typeof this.node_resource.data.clear){if(true===this.node_resource.data.clear){H(this.node_id)}}};if(t>=0){if('object'==typeof e&&'object'==typeof s){this.node_id=t;this.node_resource=e;this.node_map=s;this.slots_map=l(s||{},t);this.html=h(t,e);this.continue_button=p("button",i("continue"));this.continue_button.addEventListener(y,this.play_forward_from.bind(n,c));if(e.hasOwnProperty("data")){if(e.data.hasOwnProperty("title")){this.title=p(f,d(e.data.title,E));this.html.appendChild(this.title)}if(e.data.hasOwnProperty("brief")){this.brief=p(_,u(d(e.data.brief,E)));this.html.appendChild(this.brief)}if(e.data.hasOwnProperty("content")){this.content=p(_,u(d(e.data.content,E)));this.html.appendChild(this.content)}}this.html.appendChild(this.continue_button)}return this}throw new Error("Unable to construct `Content`")}}class Dialog{constructor(t,e,i,s){const a=this,n={"name":"Anonymous","color":"ffffff"},o=-1,u='ol',c='li',f='p';this.lines=null;this.line_elements=null;this.played_line=null;this.character_profile=null;this.character_profile_element=null;this.character_name_element=null;this.get_element=function(){return this.html};this.remove_element=function(){this.html.remove()};this.play_forward_from=function(t){t=r(t);if(false==Number.isFinite(t)||t<0){t=o}if(this.slots_map.hasOwnProperty(t)){var e=this.slots_map[t];K(e.id,e.slot)}else{X(Q.END_EDGE,a)}this.set_view_played(t)};this.skip_play=function(){this.html.setAttribute('data-skipped',true);var t=0;if(this.slots_map.length>=1){var e=Object.keys(this.slots_map);e.sort();t=e[0]}this.play_forward_from(t)};this.set_view_played=function(t){this.html.setAttribute('data-played',true);if(Number.isInteger(t)&&t>=0&&t<this.lines.length){this.played_line=p(f,d(this.lines[t],E),{class:'dialog-played-line'});this.html.appendChild(this.played_line)}else{throw new Error("Unable to set `Dialog` played: The played slot doesn't exist: ",t)}};this.set_view_unplayed=function(){this.html.setAttribute('data-played',false);if(this.played_line){this.played_line.remove();this.played_line=null}};this.step_back=function(){this.set_view_unplayed()};this.proceed=function(){if(this.node_map.hasOwnProperty("skip")&&true==this.node_map.skip){this.skip_play()}else if(o>=0){this.play_forward_from(o)}else if(this.node_resource.data.hasOwnProperty('playable')&&false===this.node_resource.data.playable){this.html.setAttribute('none-playable','true');this.random_play_none_playable_dialogs()}};this.create_line_elements=function(t,e,i){if("appendChild"in e==false){e=null}for(var s=[],r=0;r<t.length;r++){var n=p(c,d(t[r],E));if(i){n.addEventListener(y,this.play_forward_from.bind(a,r))}if(e){e.appendChild(n)}s.push(n)}return s};this.random_play_none_playable_dialogs=function(){var t=m(this.lines.length-1);this.play_forward_from(t)};this.update_character_profile=function(t){if('object'==typeof t&&t.hasOwnProperty("color")&&t.hasOwnProperty("name")){if(null==this.character_profile_element){this.character_name_element=p("div",t.name,{class:'character-name'});this.character_profile_element=p("div",this.character_name_element,{class:'character-profile',style:`--character-color: #${t.color};`,"data-name":t.name});this.html.appendChild(this.character_profile_element)}else{this.character_profile_element.setAttribute('style',`--character-color: #${t.color};`);this.character_name_element.innerHTML=t.name}}else{if(b){console.error(t)}throw new Error("Unable to Update Character Profile: Lack of required object keys, `name` and/or `color`.")}};if(t>=0){if('object'==typeof e&&'object'==typeof i){this.node_id=t;this.node_resource=e;this.node_map=i;this.slots_map=l(i||{},t);this.html=h(t,e);var _=null;if(e.hasOwnProperty('data')){if(e.data.hasOwnProperty('character')){var v=r(e.data.character);this.update_character_profile(P.hasOwnProperty(v)?P[v]:n)}if(e.data.hasOwnProperty('lines')&&Array.isArray(e.data.lines)&&e.data.lines.length>0){this.lines_holder=p(u,null,{class:"dialog-lines"});this.lines=e.data.lines;this.line_elements=this.create_line_elements(e.data.lines,this.lines_holder,true);this.html.appendChild(this.lines_holder)}else{_="No `lines` exist!"}}else{_="The resource doesn't own the required `data`."}if(_){throw new Error("Unable to create `Dialog` node! "+_)}}return this}throw new Error("Unable to construct `Dialog`")}}class Entry{constructor(t,e,i,s){const a=this,n=0;this.get_element=function(){return this.html};this.remove_element=function(){this.html.remove()};this.play_forward_from=function(t){t=r(t);if(false==Number.isFinite(t)||t<0){t=n}if(this.slots_map.hasOwnProperty(t)){var e=this.slots_map[t];K(e.id,e.slot)}else{X(Q.END_EDGE,a)}this.set_view_played(t)};this.skip_play=function(){this.html.setAttribute('data-skipped',true);this.play_forward_from(n)};this.set_view_played=function(){this.html.setAttribute('data-played',true)};this.set_view_unplayed=function(){this.html.setAttribute('data-played',false)};this.step_back=function(){this.set_view_unplayed()};this.proceed=function(){if(this.node_map.hasOwnProperty("skip")&&true==this.node_map.skip){this.skip_play()}else if(n>=0){this.play_forward_from(n)}};if(t>=0){if('object'==typeof e&&'object'==typeof i){this.node_id=t;this.node_resource=e;this.node_map=i;this.slots_map=l(i||{},t);this.html=h(t,e);this.entry_button=p("button",e.name);this.entry_button.addEventListener(y,this.play_forward_from.bind(a,n));this.html.appendChild(this.entry_button)}return this}throw new Error("Unable to construct `Entry`")}}class Generator{constructor(t,e,s,a){const n=this,o=0,d="Parameters unset or invalid!",u="|",c="AaBbCcDdEeFfGgHhIiJjKkLlMmNnOoPpQqRrSsTtUuVvWwXxYyZz123456789",f={"num":{"randi":{"title":"Random Integer","func":function(t){var e=null;if(Array.isArray(t)&&5==t.length){if(Number.isInteger(t[0])&&t[0]>=0&&Number.isInteger(t[1])&&t[1]>=2){e=m(t[0],t[1]-1,void 0,t[2],t[3],t[4])}else if(b){console.warn("Unexpected Behavior! Bad range for `randi` generator: ",t)}}else if(b){console.warn("Unexpected Behavior! Wrong arguments for `randi` generator: ",t)}if(null===e){e=m(0,100)}return e}}},"str":{"ascii":{"title":"Random ASCII String","func":function(t){var e="";if(2==t.length){var i="string"==typeof t[0]&&t[0].length>0?t[0]:c,s=i.length,a="number"==typeof t[1]&&t[1]>=1?Math.floor(t[1]):s;while(e.length<a){let t=m(0,s-1);console.log(t);e+=i[t]}}return e}},"strst":{"title":"From Set of Strings","func":function(t){var e="";if("string"==typeof t&&t.length>0){var i=t.split(u).filter(t=>t.length>0);if(i.length>0){e=i[m(0,i.length-1)]}}return e}}},"bool":{"rnbln":{"title":"Random Boolean","func":function(t){return Math.floor(10*Math.random())%2==0}}}};this.the_variable=null;this.the_variable_id=null;this.previous_variable_value=null;this.get_element=function(){return this.html};this.remove_element=function(){this.html.remove()};this.play_forward=function(){if(this.slots_map.hasOwnProperty(o)){var t=this.slots_map[o];K(t.id,t.slot)}else{X(Q.END_EDGE,n)}this.set_view_played(o)};this.skip_play=function(){this.html.setAttribute('data-skipped',true);this.play_forward()};this.set_view_played=function(){this.html.setAttribute('data-played',true)};this.set_view_unplayed=function(){this.html.setAttribute('data-played',false)};this.step_back=function(){if(this.the_variable&&null!==this.previous_variable_value){D(this.the_variable_id,this.previous_variable_value)}this.set_view_unplayed()};this.generate_and_play=function(){var t=null;if(this.valid_generator){t=this.valid_generator.func.call(null,this.node_resource.data.hasOwnProperty("arguments")?this.node_resource.data.arguments:null)}if(null!==t&&this.the_variable){D(this.the_variable_id,t);this.play_forward()}else{console.error(`Unable to run the generator (${this.node_resource.name}.) Skipped forward.`);this.skip_play()}};this.proceed=function(){if(this.node_map.hasOwnProperty("skip")&&true==this.node_map.skip){this.skip_play()}else{this.generate_and_play()}};if(t>=0){if('object'==typeof e&&'object'==typeof s){this.node_id=t;this.node_resource=e;this.node_map=s;this.slots_map=l(s||{},t);this.valid_generator=null;if(this.node_resource.hasOwnProperty("data")&&this.node_resource.data.hasOwnProperty("variable")){this.the_variable_id=r(this.node_resource.data.variable);if(k.hasOwnProperty(this.the_variable_id)){this.the_variable=k[this.the_variable_id];this.previous_variable_value=this.the_variable.value;if(this.node_resource.data.hasOwnProperty("method")&&this.the_variable.hasOwnProperty("type")&&f.hasOwnProperty(this.the_variable.type)&&f[this.the_variable.type].hasOwnProperty(this.node_resource.data.method)){this.valid_generator=f[this.the_variable.type][this.node_resource.data.method]}}else if(b){console.warn("Invalid Generator Node! The node has nonexistent UID as the target variable:",this.the_variable_id,this.node_resource)}}else if(b){console.warn("Invalid Generator Node! The node has no data set or target variable.",this.node_resource)}this.html=h(t,e);var _=this.valid_generator?`${this.valid_generator.title} => ${this.the_variable.name}`:d;this.parsed_expression=p("code",_,{"class":"expression"});this.html.appendChild(this.parsed_expression);this.eval_button=p("button",i("generate"));this.eval_button.addEventListener(y,this.generate_and_play.bind(n));this.html.appendChild(this.eval_button)}return this}throw new Error("Unable to construct `VariableUpdate`")}}class Hub{constructor(t,e,i,s){const a=this,n=0;this.get_element=function(){return this.html};this.remove_element=function(){this.html.remove()};this.play_forward_from=function(t){t=r(t);if(false==Number.isFinite(t)||t<0){t=n}if(this.slots_map.hasOwnProperty(t)){var e=this.slots_map[t];K(e.id,e.slot)}else{X(Q.END_EDGE,a)}this.set_view_played(t)};this.skip_play=function(){this.html.setAttribute('data-skipped',true);this.play_forward_from(n)};this.set_view_played=function(t){this.html.setAttribute('data-played',true)};this.set_view_unplayed=function(){this.html.setAttribute('data-played',false)};this.step_back=function(){this.set_view_unplayed()};this.proceed=function(){if(this.node_map.hasOwnProperty("skip")&&true==this.node_map.skip){this.skip_play()}else if(n>=0){this.play_forward_from(n)}};if(t>=0){if('object'==typeof e&&'object'==typeof i){this.node_id=t;this.node_resource=e;this.node_map=i;this.slots_map=l(i||{},t);this.html=h(t,e);this.hub_button=p("button",e.name);this.hub_button.addEventListener(y,this.play_forward_from.bind(a,n));this.html.appendChild(this.hub_button)}return this}throw new Error("Unable to construct `Hub`")}}class Interaction{constructor(t,e,i,s){const a=this,n=-1,o='ol',u='li',c='p';this.actions=null;this.action_elements=null;this.played_action=null;this.get_element=function(){return this.html};this.remove_element=function(){this.html.remove()};this.play_forward_from=function(t){t=r(t);if(false==Number.isFinite(t)||t<0){t=n}if(this.slots_map.hasOwnProperty(t)){var e=this.slots_map[t];K(e.id,e.slot)}else{X(Q.END_EDGE,a)}this.set_view_played(t)};this.skip_play=function(){this.html.setAttribute('data-skipped',true);var t=0;if(this.slots_map.length>=1){var e=Object.keys(this.slots_map);e.sort();t=e[0]}this.play_forward_from(t)};this.set_view_played=function(t){this.html.setAttribute('data-played',true);if(Number.isInteger(t)&&t>=0&&t<this.actions.length){this.played_action=p(c,d(this.actions[t],E),{class:'interaction-played-action'});this.html.appendChild(this.played_action)}else{throw new Error("Unable to set `Interaction` played: The played slot doesn't exist: ",t)}};this.set_view_unplayed=function(){this.html.setAttribute('data-played',false);if(this.played_action){this.played_action.remove();this.played_action=null}};this.step_back=function(){this.set_view_unplayed()};this.proceed=function(){if(this.node_map.hasOwnProperty("skip")&&true==this.node_map.skip){this.skip_play()}else if(n>=0){this.play_forward_from(n)}};this.create_action_elements=function(t,e,i){if("appendChild"in e==false){e=null}for(var s=[],r=0;r<t.length;r++){var n=p(u,d(t[r],E));if(i){n.addEventListener(y,this.play_forward_from.bind(a,r))}if(e){e.appendChild(n)}s.push(n)}return s};if(t>=0){if('object'==typeof e&&'object'==typeof i){this.node_id=t;this.node_resource=e;this.node_map=i;this.slots_map=l(i||{},t);this.html=h(t,e);var f=null;if(e.hasOwnProperty('data')){if(e.data.hasOwnProperty('actions')&&Array.isArray(e.data.actions)&&e.data.actions.length>0){this.actions_holder=p(o,null,{class:'interaction-actions'});this.actions=e.data.actions;this.action_elements=this.create_action_elements(e.data.actions,this.actions_holder,true);this.html.appendChild(this.actions_holder)}else{f="No `actions` exist!"}}else{f="The resource doesn't own the required `data`."}if(f){throw new Error("Unable to create `Interaction` node! "+f)}}return this}throw new Error("Unable to construct `Interaction`")}}class Jump{constructor(t,e,i,s){const a=this;this.get_element=function(){return this.html};this.remove_element=function(){this.html.remove()};this.play_forward_the_jump=function(){if(this.node_resource.hasOwnProperty("data")&&this.node_resource.data.hasOwnProperty("target")&&Number.isInteger(this.node_resource.data.target)&&this.node_resource.data.target>=0){K(this.node_resource.data.target,0)}else{X(Q.END_EDGE,a)}this.set_view_played()};this.skip_play=function(){this.html.setAttribute('data-skipped',true);X(Q.NO_DEFAULT,a)};this.set_view_played=function(){this.html.setAttribute('data-played',true)};this.set_view_unplayed=function(){this.html.setAttribute('data-played',false)};this.step_back=function(){this.set_view_unplayed()};this.proceed=function(){if(this.node_map.hasOwnProperty("skip")&&true==this.node_map.skip){this.skip_play()}else{this.play_forward_the_jump()}};if(t>=0){if('object'==typeof e&&'object'==typeof i){this.node_id=t;this.node_resource=e;this.node_map=i;this.slots_map=l(i||{},t);this.html=h(t,e);if(e.hasOwnProperty("data")&&e.data.hasOwnProperty("reason")&&'string'==typeof e.data.reason&&e.data.reason.length>0){this.reason=p("p",e.data.reason);this.html.appendChild(this.reason)}this.jump_button=p("button",e.name);this.jump_button.addEventListener(y,this.play_forward_the_jump.bind(a));this.html.appendChild(this.jump_button)}return this}throw new Error("Unable to construct `Jump`")}}class MacroUse{constructor(t,e,i,s){const a=this;this.holder=null;this.nodes_list=null;this.entry=null;const n=0;this.get_element=function(){return this.html};this.remove_element=function(){this.html.remove()};this.play_forward_from=function(t){t=r(t);if(false==Number.isFinite(t)||t<0){t=n}if(this.slots_map.hasOwnProperty(t)){var e=this.slots_map[t];K(e.id,e.slot)}else{X(Q.END_EDGE,a)}this.set_view_played(t)};this.skip_play=function(){this.html.setAttribute('data-skipped',true);X(Q.NO_DEFAULT,a)};this.play_self_forward=function(){this.play_forward_from(n)};this.owns_node=function(t){if(this.nodes_list){t=r(t);return this.nodes_list.includes(t)}else if(b){console.warn("Unexpected Behavior! The `macro_use` instance has no valid `nodes_list`.")}return false};this.append_instance=function(t){if(this.holder&&'appendChild'in this.holder){if('get_element'in t){this.holder.appendChild(t.get_element())}else{throw new Error("Invalid Instance! Unable to get_element from the inputted instance.")}}else{throw new Error("Unexpected Behavior! The holder element of the macro is not ready.")}};this.set_view_played=function(t){this.html.setAttribute('data-played',true)};this.set_view_unplayed=function(){this.html.setAttribute('data-played',false)};this.step_back=function(){this.set_view_unplayed()};this.proceed=function(){if(this.node_map.hasOwnProperty("skip")&&true==this.node_map.skip){this.skip_play()}else if(Number.isInteger(this.entry)&&this.entry>=0){K(this.entry)}};if(t>=0){if('object'==typeof e&&'object'==typeof i){this.node_id=t;this.node_resource=e;this.node_map=i;this.slots_map=l(i||{},t);this.html=h(t,e);this.holder=p("div");this.html.appendChild(this.holder);if(e.hasOwnProperty('data')&&e.data.hasOwnProperty('macro')){this.macro_id=r(e.data.macro);if(this.macro_id>=0){this.macro=F(this.macro_id,'scenes');if(this.macro){if(this.macro.hasOwnProperty('map')&&'object'==typeof this.macro.map){this.nodes_list=Object.keys(this.macro.map).map(r)}if(this.macro.hasOwnProperty("entry")){this.entry=r(this.macro.entry)}}else{throw new Error(`Corrupt Project Data! Node ${e.name} (macro_use) links to no valid macro (scene) resource.`)}}}if(false==Array.isArray(this.nodes_list)||0==this.nodes_list.length||false==this.nodes_list.includes(this.entry)){console.warn("Unset or invalid macro_use: ",t,e," -> Set to be skipped.");this.node_map.skip=true}}return this}throw new Error("Unable to construct `MacroUse`")}}class Marker{constructor(t,e,i,s){const a=this,n=0;this.get_element=function(){return this.html};this.remove_element=function(){this.html.remove()};this.play_forward_from=function(t){t=r(t);if(false==Number.isFinite(t)||t<0){t=n}if(this.slots_map.hasOwnProperty(t)){var e=this.slots_map[t];K(e.id,e.slot)}else{X(Q.END_EDGE,a)}this.set_view_played(t)};this.skip_play=function(){this.html.setAttribute('data-skipped',true);this.play_forward_from(n)};this.set_view_played=function(t){this.html.setAttribute('data-played',true)};this.set_view_unplayed=function(){this.html.setAttribute('data-played',false)};this.step_back=function(){this.set_view_unplayed()};this.proceed=function(){if(this.node_map.hasOwnProperty("skip")&&true==this.node_map.skip){this.skip_play()}else if(n>=0){this.play_forward_from(n)}};if(t>=0){if('object'==typeof e&&'object'==typeof i){this.node_id=t;this.node_resource=e;this.node_map=i;this.slots_map=l(i||{},t);this.html=h(t,e);if(e.hasOwnProperty("data")&&e.data.hasOwnProperty("label")&&'string'==typeof e.data.label&&e.data.label.length>0){var o=e.data.hasOwnProperty("color")?{style:`--marker-color: #${e.data.color}; `}:void 0;this.label=p("p",e.data.label,o);this.html.appendChild(this.label)}this.marker_button=p("button",e.name);this.marker_button.addEventListener(y,this.play_forward_from.bind(a,n));this.html.appendChild(this.marker_button)}return this}throw new Error("Unable to construct `Marker`")}}class Randomizer{constructor(t,e,i,s){const a=this,n=true,o=false;this.get_element=function(){return this.html};this.remove_element=function(){this.html.remove()};this.play_forward_from=function(t){t=r(t);if(this.slots_map.hasOwnProperty(t)){var e=this.slots_map[t];K(e.id,e.slot)}else{X(Q.END_EDGE,a)}this.set_view_played(t)};this.play_forward_randomly=function(){var t=-1;if(true!==o&&this.node_resource.hasOwnProperty("data")&&this.node_resource.data.hasOwnProperty("slots")){t=r(this.node_resource.data.slots)}if(t<0){t=Object.keys(this.slots_map).length}var e=m(0,t-1);this.play_forward_from(e)};this.skip_play=function(){this.html.setAttribute('data-skipped',true);this.play_forward_randomly()};this.set_view_played=function(t){this.html.setAttribute('data-played',true)};this.set_view_unplayed=function(){this.html.setAttribute('data-played',false)};this.step_back=function(){this.set_view_unplayed()};this.proceed=function(){if(this.node_map.hasOwnProperty("skip")&&true==this.node_map.skip){this.skip_play()}else if(n){this.play_forward_randomly()}};if(t>=0){if('object'==typeof e&&'object'==typeof i){this.node_id=t;this.node_resource=e;this.node_map=i;this.slots_map=l(i||{},t);this.html=h(t,e);this.randomizer_button=p("button",e.name);this.randomizer_button.addEventListener(y,this.play_forward_randomly.bind(a));this.html.appendChild(this.randomizer_button)}return this}throw new Error("Unable to construct `Randomizer`")}}class UserInput{constructor(t,e,s,a){const n=this;this.the_variable_id=null;this.the_variable=null;this.previous_variable_value=null;const o=0,u=true,c=true,f='change',_={'str':'text','num':'number','bool':'checkbox'},m=i('defaultCheckboxClickableLabelText');this.read_and_parse_value=function(){if(this.the_variable&&this.input_element){switch(this.the_variable.type){case'str':return this.input_element.value;case'num':return r(this.input_element.value,Number.NEGATIVE_INFINITY,true);case'bool':return this.input_element.checked}}else{throw new Error("Invalid Call! There is no variable or input element!")}};this.str_validator=function(t,e){var i=true,s=this.read_and_parse_value();if(true===c&&0==s.length){i=false}return i};this.num_validator=function(t,e){var i=true,s=this.read_and_parse_value();if(s==Number.NEGATIVE_INFINITY){s='';i=false}if(false!=e){this.input_element.value=s}return i};this.bool_validator=function(t){return'boolean'==typeof this.read_and_parse_value()};this.get_element=function(){return this.html};this.remove_element=function(){this.html.remove()};this.play_forward_from=function(){if(false===u||true==this.is_input_valid()){if(this.slots_map.hasOwnProperty(o)){if(this.the_variable){D(this.the_variable_id,this.read_and_parse_value())}var t=this.slots_map[o];K(t.id,t.slot)}else{X(Q.END_EDGE,n)}this.set_view_played(o)}};this.skip_play=function(){this.html.setAttribute('data-skipped',true);this.play_forward_from(o)};this.set_view_played=function(t){this.html.setAttribute('data-played',true)};this.set_view_unplayed=function(){this.html.setAttribute('data-played',false)};this.step_back=function(){if(this.the_variable&&null!==this.previous_variable_value){D(this.the_variable_id,this.previous_variable_value)}this.set_view_unplayed()};this.proceed=function(){if(this.node_map.hasOwnProperty("skip")&&true==this.node_map.skip){this.skip_play()}};if(t>=0){if('object'==typeof e&&'object'==typeof s){this.node_id=t;this.node_resource=e;this.node_map=s;this.slots_map=l(s||{},t);this.html=h(t,e);var b=null;if(e.hasOwnProperty('data')){if(e.data.hasOwnProperty('prompt')){this.prompt_element=p("p",d(e.data.prompt,E));this.html.appendChild(this.prompt_element)}if(e.data.hasOwnProperty('variable')){this.the_variable_id=r(e.data.variable);if(k.hasOwnProperty(this.the_variable_id)){this.the_variable=k[this.the_variable_id];this.previous_variable_value=this.the_variable.value;var v=_[this.the_variable.type],w=`${e.name}_input`;this.input_element=p("input",null,{id:w,type:v});this.is_input_valid=n[`${this.the_variable.type}_validator`].bind(n);this.input_element.addEventListener(f,this.is_input_valid);this.html.appendChild(this.input_element);if('checkbox'==v){var g=p('label',m,{for:w});this.html.appendChild(g)}}else{b="Invalid target variable id."}}this.continue_button=p("button",i('continue'));this.continue_button.addEventListener(y,this.play_forward_from.bind(n));this.html.appendChild(this.continue_button)}if(b){console.error(`Corrupt user_input node (${e.name}) resource data: `,b,'\nNode set to be skipped.');this.node_map.skip=true}}return this}throw new Error("Unable to construct `UserInput`")}}class VariableUpdate{constructor(t,e,s,a){const n=this,o=0,d="Parameters unset or invalid!";this.the_variable=null;this.the_variable_id=null;this.previous_variable_value=null;this.get_element=function(){return this.html};this.remove_element=function(){this.html.remove()};this.play_forward=function(){if(this.slots_map.hasOwnProperty(o)){var t=this.slots_map[o];K(t.id,t.slot)}else{X(Q.END_EDGE,n)}this.set_view_played(o)};this.skip_play=function(){this.html.setAttribute('data-skipped',true);this.play_forward()};this.set_view_played=function(){this.html.setAttribute('data-played',true)};this.set_view_unplayed=function(){this.html.setAttribute('data-played',false)};this.step_back=function(){if(this.the_variable&&null!==this.previous_variable_value){D(this.the_variable_id,this.previous_variable_value)}this.set_view_unplayed()};this.evaluation_and_play=function(){var t=null;if(this.update_expression){t=this.update_expression.evaluate()}if(null!==t&&this.the_variable){D(this.the_variable_id,t);this.play_forward()}else{console.error(`Unable to evaluate the variable_update (${this.node_resource.name}) expression. Skipped forward.`);this.skip_play()}};this.proceed=function(){if(this.node_map.hasOwnProperty("skip")&&true==this.node_map.skip){this.skip_play()}else{this.evaluation_and_play()}};if(t>=0){if('object'==typeof e&&'object'==typeof s){this.node_id=t;this.node_resource=e;this.node_map=s;this.slots_map=l(s||{},t);this.update_expression=null;if(this.node_resource.hasOwnProperty("data")&&this.node_resource.data.hasOwnProperty("variable")){this.the_variable_id=r(this.node_resource.data.variable);try{this.update_expression=new VariableUpdateExpression(this.node_resource.data,k);this.the_variable=this.update_expression.variable;this.previous_variable_value=this.the_variable.value}catch(t){if(b){console.warn('Invalid Variable_Update Expression. Error:'+t)}}}this.html=h(t,e);if(this.update_expression){var u=this.update_expression.parse()||d;this.parsed_expression=p("code",u,{"class":"expression"});this.html.appendChild(this.parsed_expression)}this.eval_button=p("button",i("evaluate"));this.eval_button.addEventListener(y,this.evaluation_and_play.bind(n));this.html.appendChild(this.eval_button)}return this}throw new Error("Unable to construct `VariableUpdate`")}}class VariableUpdateExpression{constructor(t,e){const i=this;this.data=null;this.variable=null;const s={0:"value",1:"variable"},a={"value":0,"variable":1},l={"num":{"set":{"text":"Set Equel","sign":"="},"add":{"text":"Addition","sign":"+="},"sub":{"text":"Subtraction","sign":"-="},"div":{"text":"Division","sign":"/="},"rem":{"text":"Remainder","sign":"%="},"mul":{"text":"Multipication","sign":"*="},"exp":{"text":"Exponentiation","sign":"^="},"abs":{"text":"Absolute","sign":"=||"}},"str":{"set":{"text":"Set","sign":"="},"stc":{"text":"Set Capitalized","sign":"C="},"stl":{"text":"Set Lowercased","sign":"l="},"stu":{"text":"Set Uppercased","sign":"U="},"ins":{"text":"End Insertion","sign":"=+"},"inb":{"text":"Begining Insertion","sign":"+="}},"bool":{"set":{"text":"Set","sign":"="},"neg":{"text":"Set Negative","sign":"=!"}}},h=["variable","operator","with"],p="{ident} {operator_sign} {parameter}",u="Self (Intial Value)",c="`%s`";this.parse=function(){var t=null;if(this.variable&&this.data){this.expression={"ident":null,"operator_sign":null,"parameter":null};this.expression.ident=this.variable.name;if(l[this.variable.type].hasOwnProperty(this.data.operator)){this.expression.operator_sign=l[this.variable.type][this.data.operator].sign}switch(this.data.with[0]){case a.value:if("str"==this.variable.type){this.expression.parameter=c.replace("%s",this.data.with[1])}else{this.expression.parameter=this.data.with[1]}break;case a.variable:if(this.data.with[1]==this.data.variable){this.expression.parameter=u}else if(k.hasOwnProperty(this.data.with[1])){var e=k[this.data.with[1]];this.expression.parameter=e.name}break}for(const t in this.expression){if(this.expression.hasOwnProperty(t)){if(null===this.expression[t]){this.expression=null;break}}}t=this.expression?d(p,this.expression):null}return t};this.evalutors={"str":function(t,e,i){var s=null;switch(e){case"set":s=i;break;case"stc":s=_(i);break;case"stl":s=i.toLowerCase();break;case"stu":s=i.toUpperCase();break;case"ins":s=t+i;break;case"inb":s=i+t;break}return s},"num":function(t,e,i){var s=null;switch(e){case"set":s=i;break;case"add":s=t+i;break;case"sub":s=t-i;break;case"div":s=t/i;break;case"rem":s=t%i;break;case"mul":s=t*i;break;case"exp":s=Math.pow(t,i);break;case"abs":s=Math.abs(i);break}return Number.isFinite(s)?Math.round(s):null},"bool":function(t,e,i){var s=null;switch(e){case"set":s=i;break;case"neg":s=!i;break}return s}};this.evaluate=function(){var t=null;if(this.variable){var e=this.variable.type,i=this.variable.value,s;switch(this.data.with[0]){case a.value:s=this.data.with[1];break;case a.variable:var o=this.data.with[1];if(k.hasOwnProperty(o)){if(o==this.data.variable){s=k[o].init}else{s=k[o].value}}break}if(null!==s){if("str"==e&&'string'!=typeof s){s=s.toString()}else if("num"==e&&'number'!=typeof s){s=r(s,0)}else if("bool"==e&&'boolean'!=typeof s){s=n(s)}if(l[e].hasOwnProperty(this.data.operator)){t=this.evalutors[e](i,this.data.operator,s)}}}return t};if(o(t,h)&&Array.isArray(t.with)&&2==t.with.length){this.data=t;var f=r(t.variable);if(k.hasOwnProperty(f)){this.variable=k[t.variable]}}else{throw new Error("Invalid VariableUpdate! Some of the required data is missing: "+h.join(", "))}}}const b=true,y='click',v='en',w=true;var g={},k={},E={},O={},P={},C=[],x=[];const A=document.getElementsByTagName('html')[0];if(PROJECT.meta.hasOwnProperty("rtl")&&true==PROJECT.meta.rtl){A.setAttribute("dir","rtl")}console.log(`\nHello and welcome to,\n    '${PROJECT.title}'\nMade with Arrow\n`);const N={"condition":Condition,"content":Content,"dialog":Dialog,"entry":Entry,"generator":Generator,"hub":Hub,"interaction":Interaction,"jump":Jump,"macro_use":MacroUse,"marker":Marker,"randomizer":Randomizer,"user_input":UserInput,"variable_update":VariableUpdate},$=["name","color"];function U(){var t=PROJECT.resources.characters;for(const e in t){if(t.hasOwnProperty(e)){if(o(t[e],$)){P[e]=t[e]}else{throw new Error(`Unable to sort characters! The character '${e}' resource doesn't include required data! ${$.join(", ")}`)}}}}const I=["name","type","init"],T=["num","str","bool"];function j(){var t=PROJECT.resources.variables;for(const e in t){if(t.hasOwnProperty(e)){if(o(t[e],I)&&T.includes(t[e].type)){k[e]=t[e];k[e].value=t[e].init;O[t[e].name]=e;E[t[e].name]=k[e].value;S(t[e].name,k[e].value)}else{throw new Error(`Unable to sort global variables! The variable '${e}' resource doesn't include required data! ${I.join(", ")}`)}}}}function D(t,e){if(k.hasOwnProperty(t)){var i=k[t].type;if('str'==i&&'string'==typeof e||'num'==i&&Number.isInteger(e)||'bool'==i&&'boolean'==typeof e){var s=k[t].name;E[s]=e;k[t].value=e;S(s,e);if(b){console.log("Variable Updated: ",s,"=",e)}}else{throw new Error(`Unable to Update Global Variable! Type Inconsistency: new value ${e}<${typeof e}> for ${t}<${i}>`)}}else{throw new Error(`Unable to Update Global Variable by ID: No variable with ID '${t}'`)}}function L(t,e){if(O.hasOwnProperty(t)){D(O[t],e)}else{throw new Error(`Unable to Update Global Variable by Name: No variable with name '${t}'`)}}function S(t,e){g.CONSOLE.setAttribute(`data-${V(t)}`,'string'==typeof e?e:e.toString())}const R=["title","entry","meta","next_resource_seed","resources"],G=["scenes","nodes","variables","characters"],M={"scenes":["name","entry","map"],"nodes":["type","name","data"],"variables":["name","type","init"],"characters":["name","color"]};function q(t){if(!t){t=PROJECT}if('object'==typeof t){if(o(t,R)){if(o(t.resources,G)){if(Number.isInteger(t.entry)&&t.resources.nodes.hasOwnProperty(t.entry)){for(const e in t.resources){if(t.resources.hasOwnProperty(e)){for(const i in t.resources[e]){if(t.resources[e].hasOwnProperty(i)){if(r(i,-1)<0||'object'!=typeof t.resources[e][i]||true!=o(t.resources[e][i],M[e])){return false}else{switch(e){case"scenes":for(const s in t.resources[e][i].map){if(r(s,-1)<0||'object'!=typeof t.resources[e][i].map[s]){return false}}break;case"nodes":if('object'!=typeof t.resources[e][i].data){return false}break;case"variables":break;case"characters":break}}}}}}return true}}}}return false}function F(t,e){var i=null;if("string"!=typeof e||0==e.length||false==PROJECT.resources.hasOwnProperty(e)){e="nodes"}if(PROJECT.resources[e].hasOwnProperty(t)){i=PROJECT.resources[e][t]}else{for(const e in PROJECT.resources){if(PROJECT.resources.hasOwnProperty(e)){if(PROJECT.resources[e].hasOwnProperty(t)){i=PROJECT.resources[e][t]}}}}return i}function B(t,e){var i=PROJECT.resources.scenes;for(const s in i){if(i.hasOwnProperty(s)){if(i[s].map.hasOwnProperty(t)){if(true===e){return s}return i[s]}}}return null}function J(t){var e=B(t);if(e){if(e.hasOwnProperty("map")&&e.map.hasOwnProperty(t)){return e.map[t]}else{return null}}else{throw new Error(`Unable to get node (${t}) map: It belongs to no scene!`)}}function V(t){if('string'==typeof t&&t.length>0){return t.toLowerCase().replace(/\W/gi,"-")}else{throw new Error("Unable to scape the name. It must be a string longer than 0 chars.")}}function z(t,e){if(true===e){x=[]}if(t&&'string'==typeof t){x.push(V(t))}g.CONTENT.setAttribute("data-open-nodes",x.join(' '))}function H(t){for(var e=0,i=C.length-1;i>=0;i--){if(C[i].id==t){e=i;break}}if(e>0){x.splice(0,e);var s=C.splice(0,e);for(var a of s){a.instance.remove_element()}z();if(1==C.length){C[0].instance.step_back()}}else{throw new Error(`The annotated node (${t}) is not open or is the first one. We can only clean view from a node backward.`)}}function W(t){(t||document.activeElement).scrollIntoView({behavior:'smooth',block:'center',inline:'center'})}var Y=null;function K(t,e){var i,s,a,n;t=r(t);e=r(e);s=F(t);a=J(t);if(t>=0){if(N.hasOwnProperty(s.type)){n=new N[s.type](t,s,a,e);C.push({id:t,instance:n});z(s.name);var o=n.get_element(),l=false;if(Y){if(Y.owns_node(t)){Y.append_instance(n);l=true}else{Y.set_view_played();Y=null}}if(false==l){g.CONTENT.appendChild(o)}if('macro_use'==s.type){Y=n}n.proceed();W(o)}else{i="Node Instancing Failed! The node type might be invalid."}}else{i="Invalid Node Resource!"}if(i){if(b){console.error(t,s)}throw new Error(i+` Unable to play the node (${t}.)`)}}const Q={"END_EDGE":0,"NO_DEFAULT":1};function X(t,e){switch(t){case Q.END_EDGE:if(Y){Y.play_self_forward();Y=null}else{if(true!==w){g.CONTENT.appendChild(p('div',i('end_of_play'),{class:'end-message'}))}console.log("End of Play!")}break;case Q.NO_DEFAULT:if("macro_use"==e.node_resource.type){Y.play_self_forward();Y=null}if(b){console.log(`NO Action! The node ${e.node_resource.name} has taken no special or default action.\nCheck if parameters are unset or the node is skipped.`)}break}}function Z(t,e){var i=null,s=C.length;if(s>1){if(false==Number.isInteger(t)||t<1||t>=s){t=1;if(b){console.warn("Unset or too many steps back. Reset to 1.")}}var a=s-t;x.splice(a);var r=C.splice(a);for(var n of r){n.instance.remove_element()}z();C[a-1].instance.step_back()}else{i="There is only one remained open node! We can't step back anymore."}if(i&&false!=e){throw new Error(i)}}var tt=false;function et(t){tt='boolean'===typeof t?t:!tt;A.setAttribute('data-theme',tt?'dark':'light');window.localStorage['_arrow_runtime_darkmode']=tt}const it=function(){g.CONSOLE=document.getElementById("console");g.CONTENT=document.getElementById("content");if(false==t.includes(v)){throw new Error(`The set _LOCALE (${v}) is not supported! To add a new one, edit i18n module.`)}var e=null;if("object"==typeof PROJECT&&true===q()){j();U();K(PROJECT.entry);if(b){console.log(`Project Validation [OK]. Running from the project's entry node (${PROJECT.entry}) ...`)}}else{e="Project Data seems Corrupt !!"}if(e){throw new Error("Unable to Run the Project: "+e)}try{const t=document.getElementById('switch-dark-mode');if(t){t.addEventListener(y,et);if(window.localStorage&&'_arrow_runtime_darkmode'in window.localStorage){et('true'===window.localStorage._arrow_runtime_darkmode||true===window.localStorage._arrow_runtime_darkmode?true:false)}}}catch(t){if(b){console.warn("Dark-mode is Not Available! The `#switch-dark-mode` button is missing.")}}try{const t=document.getElementById('play-back');if(t){t.addEventListener(y,Z.bind(null,1,false))}}catch(t){if(b){console.warn("Play-Back is Not Available! The `#play-back` button is missing.")}}};window.addEventListener("load",it); </script> <style> :root{--color-0:rgb(255, 255, 255);--color-1:rgb(249, 249, 250);--color-2:rgb(26, 0, 52);--color-3:rgb(0, 21, 41);--color-4:rgb(230, 230, 230);--color-5:rgb(0, 98, 128);--color-6:rgb(90, 90, 90);--color-7:rgb(170, 170, 170)}:root[data-theme^=dark]{--color-0:rgb(0, 0, 0);--color-1:rgb(30, 30, 30);--color-2:rgb(255, 252, 222);--color-3:rgb(255, 206, 97);--color-4:rgb(49, 49, 49);--color-5:rgb(18, 226, 176);--color-6:rgb(181, 181, 181);--color-7:rgb(142, 117, 64)}:root{--font:monospace,sans-serif;font-family:var(--font);background-color:var(--color-1);color:var(--color-2);font-size:16px;font-weight:400;--font-weight-emphasis:500;--font-weight-buttons:700;--font-weight-buttons-secondary:400;width:100vw;line-height:1.15;--transition-time-medium:0.5s;--border-width-normal:1px;--border-color-normal:var(--color-4)}:root{scrollbar-color:var(--color-7) var(--color-4);scrollbar-width:auto}:root::-webkit-scrollbar{height:100%;width:.75rem}:root::-webkit-scrollbar-track-piece{background-color:var(--color-4)}:root::-webkit-scrollbar-thumb{background-color:var(--color-7)}body{padding:0;margin:0;font-family:var(--font);width:95vw;margin:0 2.5vw;overflow-x:hidden;box-sizing:border-box;border:none;outline:0;padding:.25rem 1rem}body>:first-child{margin-top:1rem!important}p,pre{overflow:visible;white-space:pre-wrap;overflow-wrap:break-word;font-size:1.124rem;line-height:1.5em}h1,h2,h3,h4,h5,h6{font-weight:400;margin:1em 0 .1em 0}h1{font-size:1.5em}h2{font-size:1.4em}h3{font-size:1.3em}h4{font-size:1.2em}h5{font-size:1.1em}h6{font-size:1em}a{color:var(--color-2);background-color:transparent;text-decoration:underline;cursor:pointer}div,fieldset,form{width:100%;box-sizing:border-box;border-color:var(--color-6);border-width:1px;margin:.5rem 0}button,input{overflow:visible;text-transform:none;font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{margin:.25rem 0;box-sizing:content-box}input,input::placeholder{font-family:var(--font)}input[type=text]::placeholder{color:var(--color-7)}input[type=number],input[type=text]{border:solid 2px var(--color-6);padding:.25rem .5rem;letter-spacing:.125rem;vertical-align:middle;border-radius:.25rem;text-align:center}input[type=number],input[type=text],input[type=text]::placeholder{height:2rem;font-size:1rem}input[type=number],input[type=text]{border-color:var(--color-4);background-color:var(--color-0);color:var(--color-3)}button,input[type=button],input[type=submit]{font-size:1rem;font-weight:var(--font-weight-buttons);height:1.75rem;padding:.25rem .75rem;border-radius:.25rem;border:none;background-color:var(--color-4);color:var(--color-5);cursor:pointer;outline:0}button::-moz-focus-inner,button:active,input[type=button]::-moz-focus-inner,input[type=button]:active,input[type=submit]::-moz-focus-inner,input[type=submit]:active{border-style:none;border:none;padding:.25rem .75rem;outline:0}button:hover,input[type=button]:hover,input[type=submit]:hover{color:var(--color-3)}button:active,input[type=button]:active,input[type=submit]:active{color:var(--color-0);background-color:var(--color-5)}textarea{display:block;width:100%;height:16vh;font-family:inherit;line-height:1.15;font-size:.9rem;margin:.25rem 0;padding:1rem;box-sizing:border-box;border:solid 1px var(--color-6);background-color:var(--color-0);color:var(--color-3);resize:vertical;margin-bottom:.75rem;overflow:auto}fieldset{display:block;box-sizing:border-box;margin-top:.75rem;border-color:var(--color-6);padding:.35em .75em .625em}legend{text-align:left;color:var(--color-6);box-sizing:border-box;display:table;max-width:100%;font-size:.9em;padding:0 .25em;white-space:normal}input[type=number]::-webkit-inner-spin-button,input[type=number]::-webkit-outer-spin-button{-webkit-appearance:none;margin:0}input[type=number]{-moz-appearance:textfield}em{font-style:italic}u{text-decoration:underline}strong{font-weight:bolder}header{padding-bottom:1rem;margin-bottom:1rem;border-bottom:solid var(--border-width-normal) var(--border-color-normal)}header>h1{font-size:2.5rem;font-weight:300;margin:2rem 0}header>h2{font-size:1.5rem;margin:1.5rem 0;font-weight:300}header>h2 span{font-size:.75em;vertical-align:top}#content .end-message{margin-top:2rem;color:var(--color-7)}footer{border-top:solid var(--border-width-normal) var(--border-color-normal);font-size:.8rem;margin-top:5rem;margin-bottom:5rem;padding-top:.25em}footer a{color:var(--color-3);text-decoration:none}footer a:hover{color:var(--color-5)}footer a:active{color:var(--color-3)}footer p{font-size:.9rem;padding:.25em 0;margin:0}footer p:first-of-type{margin-top:1rem}footer button:not(:first-of-type){margin:0 .5rem}.node{--mark-node-read-opacity:1;--shown-skipped-node-opacity:0.7;transition:filter var(--transition-time-medium) ease-in-out}.node[data-type=content][data-played=true]{filter:opacity( var(--mark-node-read-opacity) )}.node[data-type=content][data-played=true] button{display:none}.node[data-type=content][data-played=false][data-skipped=true]>:not(button){filter:opacity( var(--shown-skipped-node-opacity) )}.node[data-type=content][data-played=true][data-skipped=true]{display:none}.node[data-type=condition][data-played=true]{display:none}.node[data-type=condition] button{margin:.5rem}.node[data-type=dialog] .character-name::before{content:"";display:inline-block;width:.75rem;height:.75rem;vertical-align:middle;margin:.5rem;border:solid .125rem var(--color-7);transform:translateY(calc(-.125rem / 2));border-radius:100%;background-color:var(--character-color)}.node[data-type=dialog] .character-name::after{content:":"}.node[data-type=dialog] .dialog-lines{list-style:none;padding:0;margin:0}.node[data-type=dialog] .dialog-lines li{margin:.5rem 2rem;border-left:dashed .125rem var(--color-5);padding-left:1rem;cursor:pointer;font-weight:var(--font-weight-buttons);text-decoration:underline;font-size:1.125em}.node[data-type=dialog] .dialog-lines li:hover{color:var(--color-5)}.node[data-type=dialog] .dialog-played-line{font-size:1.1em;font-weight:var(--font-weight-emphasis);border-left:solid .125rem var(--color-6);padding:.75em;margin:.5rem 2rem}.node[data-type=dialog][data-played=true]{filter:opacity( var(--mark-node-read-opacity) )}.node[data-type=dialog][data-played=true] .dialog-lines{display:none}.node[data-type=entry][data-played=true]{display:none}.node[data-type=generator][data-played=true]{display:none}.node[data-type=generator] button{margin:.5rem}.node[data-type=hub][data-played=true]{display:none}.node[data-type=interaction] .interaction-actions{list-style:none;padding:0;margin:0}.node[data-type=interaction] .interaction-actions li{margin:.5rem 0;border-left:dashed .125rem var(--color-5);padding-left:1rem;cursor:pointer;font-weight:var(--font-weight-buttons);text-decoration:underline;font-size:1.125em}.node[data-type=interaction] .interaction-actions li:hover{color:var(--color-5)}.node[data-type=interaction] .interaction-played-action{font-size:1.1em;font-weight:var(--font-weight-emphasis);border-left:solid .125rem var(--color-6);padding:.75em;margin:.5rem 0}.node[data-type=interaction][data-played=true]{filter:opacity( var(--mark-node-read-opacity) )}.node[data-type=interaction][data-played=true] .interaction-actions{display:none}.node[data-type=jump][data-played=true]{display:none}.node[data-type=macro_use]{margin:2.5rem;width:calc(95vw - 5rem)}.node[data-type=macro_use][data-played=true]{filter:opacity( var(--mark-node-read-opacity) )}.node[data-type=marker] p{color:var(--marker-color)}.node[data-type=marker][data-played=true] p{filter:opacity( .5 )}.node[data-type=marker][data-played=true] button{display:none}.node[data-type=randomizer][data-played=true]{display:none}.node[data-type=user_input] input{margin-right:1rem}.node[data-type=user_input] label{margin-right:1rem;cursor:pointer;font-weight:var(--font-weight-buttons)}.node[data-type=user_input]:not([data-played=true]) label:hover{color:var(--color-5)}.node[data-type=user_input][data-played=true] input,.node[data-type=user_input][data-played=true] label{pointer-events:none}.node[data-type=user_input][data-played=true] button{display:none}.node[data-type=variable_update][data-played=true]{display:none}.node[data-type=variable_update] button{margin:.5rem} </style> </head> <body> <header> <h1>{{project_title}}</h1> </header> <main> <section id="console"> <article id="content"> </article> </section> </main> <footer> <button id="switch-dark-mode">Switch Dark Mode</button> <button id="play-back">Back</button> <p> <time>{{project_last_save}}</time> </p> <p> Made with <a href="{{arrow_website}}"target="_blank">Arrow v{{arrow_version}}</a> </p> </footer> </body> </html> 